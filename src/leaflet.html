<html>
	<head>
		<title>Leaflet map!</title>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.css" />
		<script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.0.3/leaflet.js"></script>
		<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
		<style>
			html{
				background: #aaa;
			}
			#mapid { height: 400px; }
		</style>
	</head>
	<body>
		<h1>Hello Leaflet.js</h1>
		<div id="mapid"></div>
		<p>Here is some text.</p>
		
		<script>
			var map = L.map('mapid').setView([44.053489, -123.085817], 3);
			
			L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
				maxZoom: 18,
				attribution: 'Map data Â© <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a>'
			}).addTo(map);
			
			//L.circleMarker({"lat":45,"lng":-120}, {"radius":50}).addTo(map);
			
			//CSV
			//omnivore.csv('airports.csv',null,asdf).addTo(map);
			
			// Omnivore will AJAX-request this file behind the scenes and parse it:
			// note that there are considerations:
			// - The CSV file must contain latitude and longitude values, in column
			//   named roughly latitude and longitude
			// - The file must either be on the same domain as the page that requests it,
			//   or both the server it is requested from and the user's browser must
			//   support CORS.
			//omnivore.csv('airports.csv')
			omnivore.csv('pot.csv')
			.on('ready', function(layer) {
				// An example of customizing marker styles based on an attribute.
				// In this case, the data, a CSV file, has a column called 'state'
				// with values referring to states. Your data might have different
				// values, so adjust to fit.
				
				
				//console.log(layer.target);
				console.log(this);
				// layer.target = this
				
				
				this.eachLayer(function(marker) {
					
					console.log(marker);
					//console.log(this);
					
					//L.circleMarker(marker.getLatLng(), {"radius":20}).addTo(map);
					
					if (marker.toGeoJSON().properties.status === 'Active') {
						// The argument to L.mapbox.marker.icon is based on the
						// simplestyle-spec: see that specification for a full
						// description of options.
						//console.log("CA");
						//console.log(marker);
						//console.log(marker._latlng);
						// marker.setIcon(
						// 	L.circleMarker(marker._latlng)
						// );
						
						// Circle
						//L.circleMarker(marker.getLatLng(), {"radius":5}).addTo(map);
						// marker.setIcon(L.Marker.remove());
						
						// Leaves
						marker.setIcon(
							L.icon({
								iconUrl: 'approved.png',
								shadowUrl: 'shadow.png',
								
								iconSize:     [10,10], // size of the icon
								shadowSize:   [10,10], // size of the shadow
								iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
								shadowAnchor: [-2,-2],  // the same for the shadow
								popupAnchor:  [6,0] // point from which the popup should open relative to the iconAnchor
							}));
						// Trash
						//marker.setIcon(L.mapbox.marker.icon({
						//	'marker-color': '#ff8888',
						//	'marker-size': 'large'
						//}));
					} else {
						marker.setIcon(
							L.icon({
								iconUrl: 'pending.png',
								shadowUrl: 'shadow.png',
								
								iconSize:     [10,10], // size of the icon
								shadowSize:   [10,10], // size of the shadow
								iconAnchor:   [0, 0], // point of the icon which will correspond to marker's location
								shadowAnchor: [-2,-2],  // the same for the shadow
								popupAnchor:  [6,0] // point from which the popup should open relative to the iconAnchor
							}));
					}
					// Bind a popup to each icon based on the same properties
					//marker.bindTooltip(marker.toGeoJSON().properties.city);
					marker.bindPopup(marker.toGeoJSON().properties.city + ', ' + marker.toGeoJSON().properties.state);
				});
			})
			.addTo(map);
			
		</script>
		
	</body>
</html>